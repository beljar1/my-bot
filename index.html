<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> Beljar Ai  | Beljar Ai Pro </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        :root {
            --bg: #131314;
            --sidebar: #1e1f20;
            --input-bg: #1e1f20;
            --accent: #4b90ff;
        }
        body { font-family: 'Google Sans', sans-serif; background-color: var(--bg); color: #e3e3e3; margin: 0; overflow: hidden; }
        
        /* Layout */
        .app-container { display: flex; height: 100vh; width: 100vw; }
        
        /* Responsive Sidebar */
        #sidebar { width: 280px; background: var(--sidebar); display: flex; flex-direction: column; transition: all 0.3s ease; }
        @media (max-width: 768px) {
            #sidebar { position: fixed; left: -280px; z-index: 100; height: 100%; }
            #sidebar.active { left: 0; }
        }

        /* Chat Area */
        .main-chat { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; }
        .chat-messages { flex: 1; overflow-y: auto; padding-bottom: 180px; scroll-behavior: smooth; }
        
        /* Premium Welcome Text */
        .welcome-title {
            font-size: clamp(2.5rem, 8vw, 4rem);
            font-weight: 500;
            background: linear-gradient(90deg, #4b90ff 0%, #d96570 50%, #9171ee 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        /* Floating Centered Input */
        .input-wrapper {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(transparent, var(--bg) 30%);
            padding: 20px; box-sizing: border-box;
        }
        .input-box {
            max-width: 820px; margin: 0 auto; background: var(--input-bg);
            border-radius: 32px; padding: 8px 16px; border: 1px solid #3c4043;
            display: flex; flex-direction: column; transition: border 0.3s;
        }
        .input-box:focus-within { border-color: #5f6368; background: #28292a; }
        
        textarea {
            width: 100%; background: transparent; border: none; outline: none;
            color: #e3e3e3; font-size: 16px; padding: 12px; resize: none;
            max-height: 200px; font-family: inherit;
        }

        /* Message Bubbles */
        .user-msg { align-self: flex-end; background: #2f2f2f; border-radius: 20px; padding: 12px 20px; margin: 10px 0; max-width: 85%; }
        .ai-msg { display: flex; gap: 16px; margin: 25px 0; width: 100%; }
        .ai-icon { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(to tr, #4b90ff, #9171ee); flex-shrink: 0; }
        
        /* Shimmer Loading */
        .shimmer { height: 15px; margin-bottom: 10px; border-radius: 4px; background: linear-gradient(90deg, #1e1f20 25%, #333537 50%, #1e1f20 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        .btn-icon { color: #c4c7c5; padding: 10px; border-radius: 50%; transition: background 0.2s; cursor: pointer; }
        .btn-icon:hover { background: #333537; color: #fff; }
    </style>
</head>
<body>

    <div class="app-container">
        <aside id="sidebar">
            <div class="p-4 border-b border-white/5 flex justify-between items-center">
                <button onclick="location.reload()" class="bg-[#1a1c1e] hover:bg-[#333537] px-4 py-3 rounded-full text-sm font-medium flex items-center gap-2">
                    <span>+</span> New Chat
                </button>
                <button class="md:hidden text-2xl" onclick="toggleSidebar()">√ó</button>
            </div>
            <div class="flex-1 p-4 overflow-y-auto" id="history">
                <p class="text-[11px] text-gray-500 font-bold uppercase tracking-widest mb-4">Recent</p>
            </div>
            <div class="p-4 border-t border-white/5">
                <button onclick="openConfig()" class="w-full text-left px-4 py-3 hover:bg-[#333537] rounded-xl text-sm">‚öôÔ∏è Settings</button>
            </div>
        </aside>

        <main class="main-chat">
            <header class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center gap-4">
                    <button class="md:hidden btn-icon" onclick="toggleSidebar()">‚ò∞</button>
                    <div class="flex flex-col">
                        <select id="model-select" onchange="updateModel()" class="bg-transparent text-sm font-medium text-gray-400 outline-none border-none cursor-pointer"></select>
                    </div>
                </div>
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-600"></div>
            </header>

            <div class="chat-messages custom-scroll" id="chat-content">
                <div id="welcome-screen" class="max-w-3xl mx-auto px-6 py-20 text-left">
                    <h1 class="welcome-title">Hello, Friend</h1>
                    <p class="text-2xl md:text-3xl text-[#444746] font-medium">I'm Nexus, your manual model hub. Switch engines or upload a file to start.</p>
                </div>
            </div>

            <div class="input-wrapper">
                <div class="input-box">
                    <textarea id="user-input" rows="1" placeholder="Enter a prompt here..." oninput="autoResize(this)"></textarea>
                    <div class="flex items-center justify-between p-2">
                        <div class="flex items-center gap-1">
                            <label class="btn-icon">üìé<input type="file" class="hidden" onchange="handleFile(this)"></label>
                            <button id="mic-btn" onclick="startMic()" class="btn-icon">üéôÔ∏è</button>
                        </div>
                        <button onclick="send()" class="bg-[#4b90ff] hover:bg-blue-600 text-black h-10 w-10 rounded-full flex items-center justify-center transition-all shadow-md">
                            <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                        </button>
                    </div>
                </div>
                <p class="text-[11px] text-center text-gray-500 mt-3">Manual Hub: Use at your own risk. Double check accuracy.</p>
            </div>
        </main>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] hidden flex items-center justify-center p-4">
        <div class="bg-[#1e1f20] w-full max-w-xl rounded-[28px] p-8 border border-[#3c4043]">
            <h3 class="text-xl font-medium mb-6">Setup Manual Engines</h3>
            <div class="space-y-4">
                <input type="password" id="api-key" placeholder="OpenRouter API Key" class="w-full bg-[#131314] border border-[#3c4043] rounded-xl p-4 outline-none focus:border-[#4b90ff]">
                <div id="model-slots" class="grid grid-cols-1 gap-2 max-h-60 overflow-y-auto pr-2 custom-scroll">
                    </div>
            </div>
            <div class="flex gap-4 mt-8">
                <button onclick="closeConfig()" class="flex-1 py-4 hover:bg-[#333537] rounded-full text-xs font-bold uppercase">Cancel</button>
                <button onclick="saveConfig()" class="flex-1 py-4 bg-[#4b90ff] text-black rounded-full text-xs font-bold uppercase">Save Setup</button>
            </div>
        </div>
    </div>

    <script>
        let state = { apiKey: '', model: '', customModels: Array(5).fill().map((_, i) => ({ name: `Model ${i+1}`, id: '' })) };

        function init() {
            const saved = localStorage.getItem('nexus_gemini_v2');
            if (saved) state = JSON.parse(saved);
            
            const slotContainer = document.getElementById('model-slots');
            slotContainer.innerHTML = state.customModels.map((m, i) => `
                <div class="flex gap-2 mb-2">
                    <input type="text" value="${m.name}" placeholder="Name" class="m-name flex-1 bg-[#131314] border border-[#3c4043] p-3 rounded-lg text-sm">
                    <input type="text" value="${m.id}" placeholder="Model ID" class="m-id flex-[2] bg-[#131314] border border-[#3c4043] p-3 rounded-lg text-sm">
                </div>
            `).join('');

            renderDropdown();
        }

        function renderDropdown() {
            const select = document.getElementById('model-select');
            const active = state.customModels.filter(m => m.id);
            select.innerHTML = active.map(m => `<option value="${m.id}" ${state.model === m.id ? 'selected' : ''}>${m.name}</option>`).join('') || '<option>Setup Models First</option>';
            if(active.length > 0 && !state.model) state.model = active[0].id;
        }

        async function send() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if(!text || !state.apiKey || !state.model) return openConfig();

            document.getElementById('welcome-screen').classList.add('hidden');
            const container = document.getElementById('chat-content');
            
            // User Message UI
            container.innerHTML += `<div class="max-w-3xl mx-auto px-6"><div class="user-msg text-lg">${text}</div></div>`;
            input.value = '';
            input.style.height = 'auto';

            // AI Loading UI
            const loaderId = 'L' + Date.now();
            container.innerHTML += `
                <div id="${loaderId}" class="max-w-3xl mx-auto px-6 ai-msg">
                    <div class="ai-icon"></div>
                    <div class="w-full pt-2">
                        <div class="shimmer w-3/4"></div>
                        <div class="shimmer w-1/2"></div>
                    </div>
                </div>`;
            container.scrollTop = container.scrollHeight;

            try {
                const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${state.apiKey}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: state.model, messages: [{role: "user", content: text}] })
                });
                const data = await res.json();
                document.getElementById(loaderId).remove();

                const aiMsg = data.choices[0].message.content;
                container.innerHTML += `
                    <div class="max-w-3xl mx-auto px-6 ai-msg">
                        <div class="ai-icon"></div>
                        <div class="w-full prose prose-invert max-w-none text-[17px] leading-relaxed">
                            ${marked.parse(aiMsg)}
                            <button onclick="speakText(this)" class="mt-4 text-xs font-bold text-blue-400 uppercase tracking-widest block">üîä Listen</button>
                        </div>
                    </div>`;
                
                container.scrollTop = container.scrollHeight;
                if(/[‡¶ï-‡ßü]/.test(aiMsg)) speakText(null, aiMsg); // Auto read
            } catch (e) {
                alert("Check API Key or Model ID");
            }
        }

        function autoResize(el) { el.style.height = 'auto'; el.style.height = el.scrollHeight + 'px'; }
        function openConfig() { document.getElementById('modal').classList.remove('hidden'); document.getElementById('api-key').value = state.apiKey; }
        function closeConfig() { document.getElementById('modal').classList.add('hidden'); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

        function saveConfig() {
            state.apiKey = document.getElementById('api-key').value.trim();
            const names = document.querySelectorAll('.m-name');
            const ids = document.querySelectorAll('.m-id');
            state.customModels = Array.from(names).map((n, i) => ({ name: n.value, id: ids[i].value.trim() }));
            localStorage.setItem('nexus_gemini_v2', JSON.stringify(state));
            renderDropdown();
            closeConfig();
        }

        function speakText(btn, directText) {
            const text = directText || btn.parentElement.innerText.replace('üîä Listen', '');
            window.speechSynthesis.cancel();
            const ut = new SpeechSynthesisUtterance(text.replace(/[*#`_]/g, ''));
            ut.lang = /[‡¶ï-‡ßü]/.test(text) ? 'bn-BD' : 'en-US';
            window.speechSynthesis.speak(ut);
        }

        init();
    </script>
</body>
    </html>
