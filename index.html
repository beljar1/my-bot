<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Pro | Next-Gen AI</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        geminiBg: '#131314',
                        geminiSidebar: '#1e1f20',
                        geminiInput: '#1e1f20',
                        geminiAccent: '#4b90ff'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        body { font-family: 'Google Sans', sans-serif; background-color: #131314; color: #e3e3e3; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #3c4043; border-radius: 10px; }
        .sidebar-item:hover { background-color: #333537; }
        .sidebar-active { background-color: #333537 !important; color: #fff; }
        pre code { border-radius: 12px !important; background: #000 !important; border: 1px solid #333; }
        .input-area { box-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .loading-shimmer { animation: shimmer 1.5s infinite linear; background: linear-gradient(90deg, #1e1f20 0%, #333537 50%, #1e1f20 100%); background-size: 200% 100%; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <aside id="sidebar" class="w-72 bg-geminiSidebar hidden md:flex flex-col p-4 transition-all duration-300">
        <button onclick="createNewChat()" class="flex items-center gap-3 px-4 py-3 bg-[#1a1c1e] hover:bg-[#333537] rounded-full text-sm font-medium transition-all mb-8 w-fit shadow-md">
            <span class="text-2xl">+</span> New Chat
        </button>

        <div class="flex-1 overflow-y-auto custom-scroll space-y-1" id="chat-history">
            <p class="text-[11px] font-bold text-slate-500 uppercase px-4 mb-2">Recent</p>
            </div>

        <div class="pt-4 border-t border-white/5 space-y-2">
            <button onclick="openConfig()" class="w-full flex items-center gap-3 px-4 py-3 rounded-full hover:bg-[#333537] text-sm transition-all">
                <span>‚öôÔ∏è</span> Settings & API
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative">
        
        <header class="h-16 flex items-center justify-between px-6">
            <div class="flex items-center gap-3">
                <button class="md:hidden text-2xl" onclick="toggleSidebar()">‚ò∞</button>
                <div class="flex items-center gap-2">
                    <span class="text-lg font-medium text-slate-300">Nexus AI</span>
                    <select id="model-select" onchange="updateModel()" class="bg-transparent text-xs text-geminiAccent font-bold outline-none cursor-pointer"></select>
                </div>
            </div>
            <div class="h-8 w-8 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500"></div>
        </header>

        <div id="chat-scroll" class="flex-1 overflow-y-auto custom-scroll pb-40">
            <div class="max-w-3xl mx-auto px-4 py-10" id="chat-container">
                <div id="welcome" class="py-20 animate-fade">
                    <h1 class="text-5xl font-semibold bg-gradient-to-r from-[#4b90ff] via-[#ff5546] to-[#9171ee] bg-clip-text text-transparent mb-4">Hello, Friend</h1>
                    <p class="text-2xl text-[#444746] font-medium leading-tight">I'm your creative and helpful collaborator. How can I help you today?</p>
                </div>
            </div>
        </div>

        <div class="absolute bottom-0 left-0 w-full p-4">
            <div class="max-w-3xl mx-auto">
                <div class="bg-geminiInput rounded-[32px] p-2 flex items-end input-area border border-transparent focus-within:border-[#3c4043]">
                    <textarea id="user-input" rows="1" placeholder="Enter a prompt here..." class="w-full bg-transparent border-0 focus:ring-0 p-4 text-base resize-none outline-none text-[#e3e3e3] custom-scroll" style="max-height: 200px;"></textarea>
                    
                    <div class="flex gap-2 p-2">
                        <button onclick="send()" class="h-12 w-12 flex items-center justify-center hover:bg-[#333537] rounded-full transition-all text-geminiAccent">
                            <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                        </button>
                    </div>
                </div>
                <p class="text-[11px] text-center text-[#8e918f] mt-3">Nexus AI may display inaccurate info, so double-check its responses.</p>
            </div>
        </div>
    </main>

    <div id="config-modal" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden">
        <div class="bg-[#1e1f20] w-full max-w-2xl rounded-[28px] p-8 border border-[#3c4043] shadow-2xl overflow-y-auto max-h-[90vh] custom-scroll">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-medium">Workspace Setup</h3>
                <button onclick="closeConfig()" class="text-2xl hover:text-white">√ó</button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest block mb-2">OpenRouter API Key</label>
                    <input type="password" id="api-key-input" class="w-full bg-[#131314] border border-[#3c4043] rounded-2xl px-5 py-4 text-sm outline-none focus:border-geminiAccent">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="models-list">
                    </div>
            </div>

            <div class="mt-8 flex gap-3">
                <button onclick="closeConfig()" class="flex-1 py-4 hover:bg-[#333537] rounded-full font-bold text-xs uppercase tracking-widest transition-all">Cancel</button>
                <button onclick="saveConfig()" class="flex-1 py-4 bg-geminiAccent text-black rounded-full font-bold text-xs uppercase tracking-widest transition-all">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        let state = {
            apiKey: '',
            model: '',
            customModels: Array(5).fill().map((_, i) => ({ name: `Model ${i+1}`, id: '' })),
            chats: []
        };

        function init() {
            const saved = localStorage.getItem('nexus_gemini_pro');
            if (saved) state = JSON.parse(saved);

            const container = document.getElementById('models-list');
            container.innerHTML = state.customModels.map((m, i) => `
                <div class="p-4 bg-[#131314] rounded-2xl border border-[#3c4043] space-y-3">
                    <input type="text" value="${m.name}" placeholder="Label (e.g. Gemini Pro)" class="m-name w-full bg-transparent text-sm font-bold border-b border-[#3c4043] py-1 outline-none focus:border-geminiAccent">
                    <input type="text" value="${m.id}" placeholder="Model ID (from OpenRouter)" class="m-id w-full bg-transparent text-xs py-1 outline-none text-slate-400">
                </div>
            `).join('');

            renderDropdown();
            renderHistory();
            updateModel();

            // Auto-resize textarea
            const input = document.getElementById('user-input');
            input.addEventListener('input', () => {
                input.style.height = 'auto';
                input.style.height = input.scrollHeight + 'px';
            });
        }

        function renderDropdown() {
            const select = document.getElementById('model-select');
            const activeModels = state.customModels.filter(m => m.id);
            select.innerHTML = activeModels.map(m => 
                `<option value="${m.id}" ${state.model === m.id ? 'selected' : ''}>${m.name}</option>`
            ).join('') || '<option value="">No Models Set</option>';
        }

        async function send() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text || !state.apiKey || !state.model) return !state.apiKey ? openConfig() : null;

            const chatContainer = document.getElementById('chat-container');
            document.getElementById('welcome').classList.add('hidden');

            // User UI
            chatContainer.innerHTML += `
                <div class="flex flex-col items-end mb-8 animate-fade">
                    <div class="bg-[#2f2f2f] text-[#e3e3e3] px-6 py-3 rounded-[24px] max-w-[85%] text-base shadow-sm">${text}</div>
                </div>`;
            
            input.value = '';
            input.style.height = 'auto';

            // AI Loading UI
            const loaderId = 'loader-' + Date.now();
            chatContainer.innerHTML += `
                <div id="${loaderId}" class="flex gap-4 mb-8">
                    <div class="h-8 w-8 rounded-full bg-geminiAccent flex-shrink-0"></div>
                    <div class="w-full space-y-3 pt-1">
                        <div class="h-4 w-3/4 loading-shimmer rounded-full"></div>
                        <div class="h-4 w-1/2 loading-shimmer rounded-full"></div>
                    </div>
                </div>`;
            
            window.scrollTo(0, document.body.scrollHeight);

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${state.apiKey}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ model: state.model, messages: [{role: "user", content: text}] })
                });
                const data = await response.json();
                document.getElementById(loaderId).remove();

                const aiMsg = data.choices[0].message.content;
                chatContainer.innerHTML += `
                    <div class="flex gap-4 mb-10">
                        <div class="h-8 w-8 rounded-full bg-gradient-to-tr from-blue-400 to-indigo-600 flex-shrink-0"></div>
                        <div class="prose prose-invert prose-blue max-w-[90%] text-[#e3e3e3] leading-relaxed">
                            ${marked.parse(aiMsg)}
                        </div>
                    </div>`;
                
                hljs.highlightAll();
                document.getElementById('chat-scroll').scrollTop = document.getElementById('chat-scroll').scrollHeight;
            } catch (err) {
                document.getElementById(loaderId).innerHTML = `<p class="text-red-400 text-xs">Error: Check API/Model settings.</p>`;
            }
        }

        function openConfig() { document.getElementById('config-modal').classList.remove('hidden'); }
        function closeConfig() { document.getElementById('config-modal').classList.add('hidden'); }
        
        function saveConfig() {
            state.apiKey = document.getElementById('api-key-input').value.trim();
            const names = document.querySelectorAll('.m-name');
            const ids = document.querySelectorAll('.m-id');
            state.customModels = Array.from(names).map((n, i) => ({ name: n.value, id: ids[i].value.trim() }));
            
            if(state.customModels.find(m => m.id)) state.model = state.customModels.find(m => m.id).id;
            
            localStorage.setItem('nexus_gemini_pro', JSON.stringify(state));
            renderDropdown();
            updateModel();
            closeConfig();
        }

        function updateModel() { state.model = document.getElementById('model-select').value; }
        function createNewChat() { location.reload(); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('hidden'); }
        function renderHistory() {}

        init();
    </script>
</body>
    </html>                    <textarea id="user-input" rows="1" placeholder="Describe your problem or upload a file..." class="w-full bg-transparent border-0 focus:ring-0 p-3 text-sm resize-none max-h-48 outline-none"></textarea>

                    <button id="send-btn" onclick="handleSend()" class="m-1 h-12 w-12 rounded-full bg-accent text-white flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-lg shadow-accent/20">
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <input type="file" id="universal-file" class="hidden" multiple onchange="processFiles(event)">

    <div id="settings-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md hidden">
        <div class="bg-card w-full max-w-md rounded-[2.5rem] p-8 border border-white/10 shadow-2xl animate-msg">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-xl font-bold">API Configuration</h3>
                <button onclick="closeSettings()" class="text-slate-500 hover:text-white text-xl">‚úï</button>
            </div>
            
            <div class="space-y-6">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">OpenRouter API Key</label>
                    <input type="password" id="api-key-input" placeholder="sk-or-v1-..." class="w-full bg-surface border border-white/5 rounded-2xl px-5 py-4 text-sm outline-none focus:ring-2 focus:ring-accent transition-all">
                    <p class="text-[10px] text-slate-600">Get your key from openrouter.ai</p>
                </div>

                <div class="flex items-center justify-between p-5 bg-surface/50 rounded-2xl border border-white/5">
                    <div class="space-y-1">
                        <span class="text-sm font-semibold block">Auto-Voice Output</span>
                        <span class="text-[10px] text-slate-500">AI will read answers out loud</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="voice-answer-toggle" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:bg-accent after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
            </div>

            <button onclick="saveSettings()" class="w-full mt-8 bg-accent py-4 rounded-2xl font-bold shadow-lg shadow-accent/20 hover:scale-[1.02] active:scale-95 transition-all">Save Workspace</button>
        </div>
    </div>

    <script>
        // --- State Management ---
        let state = {
            apiKey: '',
            model: 'google/gemini-2.0-flash-exp:free',
            chats: [],
            currentChatId: null,
            voiceEnabled: true,
            files: []
        };

        const LOCAL_STORAGE_KEY = 'nexus_pro_v1_config';

        // --- Init ---
        function init() {
            const saved = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
                document.getElementById('model-select').value = state.model;
            }

            marked.setOptions({
                highlight: (code, lang) => hljs.highlightAuto(code, [lang]).value,
                breaks: true
            });

            renderHistory();
            if (state.currentChatId) loadChat(state.currentChatId);

            // Auto-resize input
            const input = document.getElementById('user-input');
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        }

        // --- Settings Logic ---
        function openSettings() {
            document.getElementById('api-key-input').value = state.apiKey;
            document.getElementById('voice-answer-toggle').checked = state.voiceEnabled;
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); }

        function saveSettings() {
            state.apiKey = document.getElementById('api-key-input').value.trim();
            state.voiceEnabled = document.getElementById('voice-answer-toggle').checked;
            saveToLocal();
            closeSettings();
        }

        function updateModelState() {
            state.model = document.getElementById('model-select').value;
            saveToLocal();
        }

        // --- Chat Logic ---
        async function handleSend() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text && state.files.length === 0) return;
            if (!state.apiKey) return openSettings();

            if (!state.currentChatId) {
                state.currentChatId = Date.now().toString();
                state.chats.push({ id: state.currentChatId, title: text.slice(0, 30) || "New Session", messages: [] });
            }

            const chat = state.chats.find(c => c.id === state.currentChatId);
            
            // Add user message
            chat.messages.push({ role: 'user', content: text, files: [...state.files] });
            
            // UI Reset
            input.value = '';
            input.style.height = 'auto';
            state.files = [];
            document.getElementById('file-previews').classList.add('hidden');
            renderMessages();
            renderHistory();

            // AI Loading Indicator
            appendAILoading();

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${state.apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: state.model,
                        messages: chat.messages.map(m => ({ role: m.role, content: m.content }))
                    })
                });

                const data = await response.json();
                const aiResult = data.choices[0].message.content;
                
                chat.messages.push({ role: 'assistant', content: aiResult });
                renderMessages();
                saveToLocal();
                if (state.voiceEnabled) speak(aiResult);

            } catch (err) {
                alert("Connection failed. Check API key and internet.");
            }
        }

        function renderMessages() {
            const chat = state.chats.find(c => c.id === state.currentChatId);
            const container = document.getElementById('message-container');
            if (!chat) return;
            
            document.getElementById('welcome').classList.add('hidden');
            container.innerHTML = '';

            chat.messages.forEach(m => {
                const div = document.createElement('div');
                div.className = `flex w-full mb-8 animate-msg ${m.role === 'user' ? 'justify-end' : 'justify-start'}`;
                
                const inner = m.role === 'user' 
                    ? `<div class="msg-user text-white px-6 py-3 rounded-3xl rounded-tr-sm shadow-xl text-sm max-w-[85%]">${m.content}</div>`
                    : `<div class="glass p-6 rounded-[2.2rem] rounded-tl-sm w-full prose prose-invert max-w-[95%] text-sm">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="text-[10px] font-extrabold text-accent uppercase tracking-widest bg-accent/10 px-2 py-1 rounded-md">Nexus Response</span>
                        </div>
                        ${marked.parse(m.content)}
                        <button onclick="speak(\`${m.content.replace(/`/g, "'")}\`)" class="mt-4 text-slate-500 hover:text-white transition-all">üîä Replay Answer</button>
                       </div>`;
                
                div.innerHTML = inner;
                container.appendChild(div);
            });
            scrollToBottom();
            highlightCode();
        }

        // --- Voice Features ---
        function speak(text) {
            window.speechSynthesis.cancel();
            const clean = text.replace(/[*#`_]/g, '');
            const utterance = new SpeechSynthesisUtterance(clean);
            utterance.lang = /[‡¶ï-‡ßü]/.test(text) ? 'bn-BD' : 'en-US';
            utterance.rate = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        function toggleMic() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return alert("Browser not supported");
            
            const recognition = new SpeechRecognition();
            recognition.start();
            document.getElementById('mic-btn').classList.add('text-red-500', 'animate-pulse');

            recognition.onresult = (e) => {
                document.getElementById('user-input').value += e.results[0][0].transcript;
                document.getElementById('mic-btn').classList.remove('text-red-500', 'animate-pulse');
            };
            recognition.onerror = () => document.getElementById('mic-btn').classList.remove('text-red-500', 'animate-pulse');
        }

        // --- File Features ---
        function triggerFile() { document.getElementById('universal-file').click(); }
        
        function processFiles(e) {
            const files = Array.from(e.target.files);
            const preview = document.getElementById('file-previews');
            preview.innerHTML = '';
            preview.classList.remove('hidden');

            files.forEach(f => {
                state.files.push({ name: f.name, type: f.type });
                const chip = document.createElement('div');
                chip.className = 'px-3 py-1.5 bg-accent/20 text-accent rounded-full text-[10px] font-bold border border-accent/20';
                chip.innerText = f.name;
                preview.appendChild(chip);
            });
            alert(`${files.length} file(s) attached for analysis.`);
        }

        // --- UI Utilities ---
        function appendAILoading() {
            const container = document.getElementById('message-container');
            const div = document.createElement('div');
            div.id = 'ai-loading';
            div.className = 'flex justify-start mb-8 animate-msg';
            div.innerHTML = `<div class="glass p-6 rounded-3xl rounded-tl-sm flex gap-1"><div class="h-2 w-2 bg-accent rounded-full typing-dot"></div><div class="h-2 w-2 bg-accent rounded-full typing-dot" style="animation-delay:0.2s"></div><div class="h-2 w-2 bg-accent rounded-full typing-dot" style="animation-delay:0.4s"></div></div>`;
            container.appendChild(div);
            scrollToBottom();
        }

        function createNewChat() {
            state.currentChatId = null;
            document.getElementById('message-container').innerHTML = `
                <div id="welcome" class="text-center py-20 space-y-6">
                    <div class="text-6xl animate-bounce">‚ú®</div>
                    <h1 class="text-4xl font-extrabold tracking-tight text-white">New Intelligence Session</h1>
                    <p class="text-slate-400 text-sm max-w-sm mx-auto leading-relaxed">Choose a model and let's get started.</p>
                </div>
            `;
            document.getElementById('session-title').innerText = "New Session";
            if (window.innerWidth < 768) toggleSidebar();
        }

        function loadChat(id) {
            state.currentChatId = id;
            const chat = state.chats.find(c => c.id === id);
            document.getElementById('session-title').innerText = chat.title;
            renderMessages();
            renderHistory();
            if (window.innerWidth < 768) toggleSidebar();
        }

        function renderHistory() {
            const list = document.getElementById('chat-history');
            list.innerHTML = '';
            [...state.chats].reverse().forEach(c => {
                const active = c.id === state.currentChatId;
                const div = document.createElement('div');
                div.className = `p-3 rounded-xl cursor-pointer truncate text-xs font-medium transition-all ${active ? 'bg-accent/20 text-accent border border-accent/20' : 'text-slate-500 hover:bg-white/5 hover:text-white'}`;
                div.innerText = c.title;
                div.onclick = () => loadChat(c.id);
                list.appendChild(div);
            });
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('-translate-x-full'); }
        function scrollToBottom() { const c = document.getElementById('chat-scroll'); c.scrollTop = c.scrollHeight; }
        function saveToLocal() { localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(state)); }
        function highlightCode() { document.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el)); }

        // Start
        init();
    </script>
</body>
      </html>
