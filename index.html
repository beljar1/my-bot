<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nexus AI Pro | The Ultimate Workspace</title>
    
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        accent: '#6366f1',
                        surface: '#0b0f1a',
                        card: '#161b2a',
                        border: 'rgba(255,255,255,0.08)'
                    }
                }
            }
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0b0f1a; color: #e2e8f0; }
        .glass { background: rgba(22, 27, 42, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        .msg-user { background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); }
        .typing-dot { animation: blink 1.4s infinite; }
        @keyframes blink { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-msg { animation: slideIn 0.3s ease-out forwards; }
        pre code { border-radius: 12px !important; padding: 1.5rem !important; font-size: 0.85rem !important; }
    </style>
</head>
<body class="overflow-hidden h-screen flex flex-col md:flex-row">

    <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 glass transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 flex flex-col">
        <div class="p-6 border-b border-white/5 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="h-9 w-9 bg-accent rounded-xl flex items-center justify-center text-white font-bold shadow-lg shadow-accent/20">N</div>
                <span class="font-bold text-lg tracking-tight">Nexus Pro</span>
            </div>
            <button onclick="createNewChat()" class="p-2 hover:bg-white/5 rounded-lg">‚ûï</button>
        </div>
        
        <div id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-2 custom-scroll"></div>

        <div class="p-4 border-t border-white/5">
            <button onclick="openSettings()" class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 transition-all text-sm font-medium">
                <span>‚öôÔ∏è</span> Settings & API
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative min-w-0">
        
        <header class="h-16 flex items-center justify-between px-6 glass z-40">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="md:hidden text-2xl">‚ò∞</button>
                <h2 id="session-title" class="text-sm font-semibold truncate max-w-[150px] md:max-w-xs text-slate-300">Untitled Session</h2>
            </div>
            
            <div class="flex items-center gap-3">
                <select id="model-select" onchange="updateModelState()" class="bg-white/5 border border-white/10 rounded-full text-[11px] font-bold px-4 py-1.5 outline-none hover:border-accent transition-all cursor-pointer">
                    <option value="google/gemini-2.0-flash-exp:free">Gemini 2.0 (Fast)</option>
                    <option value="deepseek/deepseek-r1:free">DeepSeek R1 (Reasoning)</option>
                    <option value="meta-llama/llama-3.3-70b-instruct:free">Llama 3.3 70B</option>
                    <option value="openai/gpt-4o">GPT-4o (Vision)</option>
                    <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                </select>
            </div>
        </header>

        <div id="chat-scroll" class="flex-1 overflow-y-auto custom-scroll">
            <div class="max-w-3xl mx-auto px-4 py-10" id="message-container">
                <div id="welcome" class="text-center py-20 space-y-6">
                    <div class="text-6xl animate-bounce">ü§ñ</div>
                    <h1 class="text-4xl font-extrabold tracking-tight text-white">Advanced Multimodal AI</h1>
                    <p class="text-slate-400 text-sm max-w-sm mx-auto leading-relaxed">Ask anything, upload files, or use voice commands. Your ultimate local AI workspace.</p>
                </div>
            </div>
        </div>

        <div class="p-4 md:p-8 bg-gradient-to-t from-surface to-transparent">
            <div class="max-w-3xl mx-auto relative">
                
                <div id="file-previews" class="flex gap-2 mb-3 hidden"></div>

                <div class="glass rounded-[1.8rem] p-2 flex items-end shadow-2xl focus-within:border-accent/50 transition-all">
                    <div class="flex p-1">
                        <button onclick="triggerFile()" class="p-3 text-slate-400 hover:text-white transition-colors" title="Attach Files">üìé</button>
                        <button id="mic-btn" onclick="toggleMic()" class="p-3 text-slate-400 hover:text-red-500 transition-colors" title="Voice Input">üéôÔ∏è</button>
                    </div>

                    <textarea id="user-input" rows="1" placeholder="Describe your problem or upload a file..." class="w-full bg-transparent border-0 focus:ring-0 p-3 text-sm resize-none max-h-48 outline-none"></textarea>

                    <button id="send-btn" onclick="handleSend()" class="m-1 h-12 w-12 rounded-full bg-accent text-white flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-lg shadow-accent/20">
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <input type="file" id="universal-file" class="hidden" multiple onchange="processFiles(event)">

    <div id="settings-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md hidden">
        <div class="bg-card w-full max-w-md rounded-[2.5rem] p-8 border border-white/10 shadow-2xl animate-msg">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-xl font-bold">API Configuration</h3>
                <button onclick="closeSettings()" class="text-slate-500 hover:text-white text-xl">‚úï</button>
            </div>
            
            <div class="space-y-6">
                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">OpenRouter API Key</label>
                    <input type="password" id="api-key-input" placeholder="sk-or-v1-..." class="w-full bg-surface border border-white/5 rounded-2xl px-5 py-4 text-sm outline-none focus:ring-2 focus:ring-accent transition-all">
                    <p class="text-[10px] text-slate-600">Get your key from openrouter.ai</p>
                </div>

                <div class="flex items-center justify-between p-5 bg-surface/50 rounded-2xl border border-white/5">
                    <div class="space-y-1">
                        <span class="text-sm font-semibold block">Auto-Voice Output</span>
                        <span class="text-[10px] text-slate-500">AI will read answers out loud</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="voice-answer-toggle" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-slate-700 rounded-full peer peer-checked:bg-accent after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
                    </label>
                </div>
            </div>

            <button onclick="saveSettings()" class="w-full mt-8 bg-accent py-4 rounded-2xl font-bold shadow-lg shadow-accent/20 hover:scale-[1.02] active:scale-95 transition-all">Save Workspace</button>
        </div>
    </div>

    <script>
        // --- State Management ---
        let state = {
            apiKey: '',
            model: 'google/gemini-2.0-flash-exp:free',
            chats: [],
            currentChatId: null,
            voiceEnabled: true,
            files: []
        };

        const LOCAL_STORAGE_KEY = 'nexus_pro_v1_config';

        // --- Init ---
        function init() {
            const saved = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (saved) {
                state = { ...state, ...JSON.parse(saved) };
                document.getElementById('model-select').value = state.model;
            }

            marked.setOptions({
                highlight: (code, lang) => hljs.highlightAuto(code, [lang]).value,
                breaks: true
            });

            renderHistory();
            if (state.currentChatId) loadChat(state.currentChatId);

            // Auto-resize input
            const input = document.getElementById('user-input');
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        }

        // --- Settings Logic ---
        function openSettings() {
            document.getElementById('api-key-input').value = state.apiKey;
            document.getElementById('voice-answer-toggle').checked = state.voiceEnabled;
            document.getElementById('settings-modal').classList.remove('hidden');
        }

        function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); }

        function saveSettings() {
            state.apiKey = document.getElementById('api-key-input').value.trim();
            state.voiceEnabled = document.getElementById('voice-answer-toggle').checked;
            saveToLocal();
            closeSettings();
        }

        function updateModelState() {
            state.model = document.getElementById('model-select').value;
            saveToLocal();
        }

        // --- Chat Logic ---
        async function handleSend() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if (!text && state.files.length === 0) return;
            if (!state.apiKey) return openSettings();

            if (!state.currentChatId) {
                state.currentChatId = Date.now().toString();
                state.chats.push({ id: state.currentChatId, title: text.slice(0, 30) || "New Session", messages: [] });
            }

            const chat = state.chats.find(c => c.id === state.currentChatId);
            
            // Add user message
            chat.messages.push({ role: 'user', content: text, files: [...state.files] });
            
            // UI Reset
            input.value = '';
            input.style.height = 'auto';
            state.files = [];
            document.getElementById('file-previews').classList.add('hidden');
            renderMessages();
            renderHistory();

            // AI Loading Indicator
            appendAILoading();

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${state.apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: state.model,
                        messages: chat.messages.map(m => ({ role: m.role, content: m.content }))
                    })
                });

                const data = await response.json();
                const aiResult = data.choices[0].message.content;
                
                chat.messages.push({ role: 'assistant', content: aiResult });
                renderMessages();
                saveToLocal();
                if (state.voiceEnabled) speak(aiResult);

            } catch (err) {
                alert("Connection failed. Check API key and internet.");
            }
        }

        function renderMessages() {
            const chat = state.chats.find(c => c.id === state.currentChatId);
            const container = document.getElementById('message-container');
            if (!chat) return;
            
            document.getElementById('welcome').classList.add('hidden');
            container.innerHTML = '';

            chat.messages.forEach(m => {
                const div = document.createElement('div');
                div.className = `flex w-full mb-8 animate-msg ${m.role === 'user' ? 'justify-end' : 'justify-start'}`;
                
                const inner = m.role === 'user' 
                    ? `<div class="msg-user text-white px-6 py-3 rounded-3xl rounded-tr-sm shadow-xl text-sm max-w-[85%]">${m.content}</div>`
                    : `<div class="glass p-6 rounded-[2.2rem] rounded-tl-sm w-full prose prose-invert max-w-[95%] text-sm">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="text-[10px] font-extrabold text-accent uppercase tracking-widest bg-accent/10 px-2 py-1 rounded-md">Nexus Response</span>
                        </div>
                        ${marked.parse(m.content)}
                        <button onclick="speak(\`${m.content.replace(/`/g, "'")}\`)" class="mt-4 text-slate-500 hover:text-white transition-all">üîä Replay Answer</button>
                       </div>`;
                
                div.innerHTML = inner;
                container.appendChild(div);
            });
            scrollToBottom();
            highlightCode();
        }

        // --- Voice Features ---
        function speak(text) {
            window.speechSynthesis.cancel();
            const clean = text.replace(/[*#`_]/g, '');
            const utterance = new SpeechSynthesisUtterance(clean);
            utterance.lang = /[‡¶ï-‡ßü]/.test(text) ? 'bn-BD' : 'en-US';
            utterance.rate = 1.0;
            window.speechSynthesis.speak(utterance);
        }

        function toggleMic() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return alert("Browser not supported");
            
            const recognition = new SpeechRecognition();
            recognition.start();
            document.getElementById('mic-btn').classList.add('text-red-500', 'animate-pulse');

            recognition.onresult = (e) => {
                document.getElementById('user-input').value += e.results[0][0].transcript;
                document.getElementById('mic-btn').classList.remove('text-red-500', 'animate-pulse');
            };
            recognition.onerror = () => document.getElementById('mic-btn').classList.remove('text-red-500', 'animate-pulse');
        }

        // --- File Features ---
        function triggerFile() { document.getElementById('universal-file').click(); }
        
        function processFiles(e) {
            const files = Array.from(e.target.files);
            const preview = document.getElementById('file-previews');
            preview.innerHTML = '';
            preview.classList.remove('hidden');

            files.forEach(f => {
                state.files.push({ name: f.name, type: f.type });
                const chip = document.createElement('div');
                chip.className = 'px-3 py-1.5 bg-accent/20 text-accent rounded-full text-[10px] font-bold border border-accent/20';
                chip.innerText = f.name;
                preview.appendChild(chip);
            });
            alert(`${files.length} file(s) attached for analysis.`);
        }

        // --- UI Utilities ---
        function appendAILoading() {
            const container = document.getElementById('message-container');
            const div = document.createElement('div');
            div.id = 'ai-loading';
            div.className = 'flex justify-start mb-8 animate-msg';
            div.innerHTML = `<div class="glass p-6 rounded-3xl rounded-tl-sm flex gap-1"><div class="h-2 w-2 bg-accent rounded-full typing-dot"></div><div class="h-2 w-2 bg-accent rounded-full typing-dot" style="animation-delay:0.2s"></div><div class="h-2 w-2 bg-accent rounded-full typing-dot" style="animation-delay:0.4s"></div></div>`;
            container.appendChild(div);
            scrollToBottom();
        }

        function createNewChat() {
            state.currentChatId = null;
            document.getElementById('message-container').innerHTML = `
                <div id="welcome" class="text-center py-20 space-y-6">
                    <div class="text-6xl animate-bounce">‚ú®</div>
                    <h1 class="text-4xl font-extrabold tracking-tight text-white">New Intelligence Session</h1>
                    <p class="text-slate-400 text-sm max-w-sm mx-auto leading-relaxed">Choose a model and let's get started.</p>
                </div>
            `;
            document.getElementById('session-title').innerText = "New Session";
            if (window.innerWidth < 768) toggleSidebar();
        }

        function loadChat(id) {
            state.currentChatId = id;
            const chat = state.chats.find(c => c.id === id);
            document.getElementById('session-title').innerText = chat.title;
            renderMessages();
            renderHistory();
            if (window.innerWidth < 768) toggleSidebar();
        }

        function renderHistory() {
            const list = document.getElementById('chat-history');
            list.innerHTML = '';
            [...state.chats].reverse().forEach(c => {
                const active = c.id === state.currentChatId;
                const div = document.createElement('div');
                div.className = `p-3 rounded-xl cursor-pointer truncate text-xs font-medium transition-all ${active ? 'bg-accent/20 text-accent border border-accent/20' : 'text-slate-500 hover:bg-white/5 hover:text-white'}`;
                div.innerText = c.title;
                div.onclick = () => loadChat(c.id);
                list.appendChild(div);
            });
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('-translate-x-full'); }
        function scrollToBottom() { const c = document.getElementById('chat-scroll'); c.scrollTop = c.scrollHeight; }
        function saveToLocal() { localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(state)); }
        function highlightCode() { document.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el)); }

        // Start
        init();
    </script>
</body>
      </html>
